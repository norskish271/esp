-- Arsenal ESP + Visible Aimbot (2026 Edition) - Rayfield UI
-- No silent aim | Smooth mouse movement aimbot | Prediction | Team checks

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Arsenal Hub 2026",
   LoadingTitle = "Arsenal Features",
   LoadingSubtitle = "ESP + Aimbot",
   ConfigurationSaving = {
      Enabled = false,
      FolderName = nil,
      FileName = "ArsenalHub"
   }
})

-- Services
local Players        = game:GetService("Players")
local RunService     = game:GetService("RunService")
local UserInput      = game:GetService("UserInputService")
local Workspace      = game:GetService("Workspace")
local LocalPlayer    = Players.LocalPlayer
local Camera         = Workspace.CurrentCamera

-- Character reference
local Character, RootPart
local function RefreshChar()
   Character = LocalPlayer.Character
   if Character then
      RootPart = Character:WaitForChild("HumanoidRootPart", 8)
   end
end
LocalPlayer.CharacterAdded:Connect(RefreshChar)
RefreshChar()

-- Settings table
local Settings = {
   ESP_Enabled      = false,
   Tracers          = false,
   HealthBar        = false,
   HeadDot          = false,
   Skeleton         = false,
   Chams            = false,
   CornerBox        = false,
   Rainbow          = false,
   ESP_TeamCheck    = true,
   VisibleCheck     = false,
   MaxDistance      = 3000,

   Aimbot           = false,
   Aimbot_TeamCheck = true,
   FOV_Circle       = true,
   FOV_Size         = 240,
   Smoothness       = 0.11,
   Prediction       = 0.138,
   AimPart          = "Head"
}

-- Storage
local ESP_Objects = {}
local Connections = {}

-- FOV Circle
local FOV = Drawing.new("Circle")
FOV.Thickness   = 1.6
FOV.NumSides    = 100
FOV.Radius      = Settings.FOV_Size
FOV.Filled      = false
FOV.Transparency= 0.75
FOV.Color       = Color3.fromRGB(255, 60, 60)
FOV.Visible     = false

-- ────────────────────────────────────────────────
--  UTILITY FUNCTIONS
-- ────────────────────────────────────────────────

local function GetRainbow()
   if not Settings.Rainbow then return nil end
   return Color3.fromHSV(tick() % 10 / 10, 0.9, 1)
end

local function GetHealthColor(h, mh)
   local p = mh > 0 and h/mh or 0
   return Color3.fromHSV(p * 0.33, 1, 1)
end

local function GetESPColor(player, visible)
   local rainbow = GetRainbow()
   if rainbow then return rainbow end
   
   if Settings.ESP_TeamCheck and player.Team == LocalPlayer.Team then
      return Color3.fromRGB(100, 180, 255)
   end
   
   if not visible and Settings.VisibleCheck then
      return Color3.fromRGB(130, 130, 130)
   end
   
   return Color3.fromRGB(255, 70, 70)
end

-- ────────────────────────────────────────────────
--  ESP CREATION
-- ────────────────────────────────────────────────

local function CreateESP(player)
   if player == LocalPlayer or ESP_Objects[player] then return end

   local drawings = {
      Box       = Drawing.new("Square"),
      Tracer    = Drawing.new("Line"),
      Name      = Drawing.new("Text"),
      Distance  = Drawing.new("Text"),
      HealthOut = Drawing.new("Line"),
      HealthIn  = Drawing.new("Line"),
      HeadDot   = Drawing.new("Circle"),
   }

   local skeletonLines = {}
   local skeletonParts = {
      {"Head", "UpperTorso"}, {"UpperTorso", "LowerTorso"},
      {"UpperTorso", "LeftUpperArm"},  {"LeftUpperArm", "LeftLowerArm"},  {"LeftLowerArm", "LeftHand"},
      {"UpperTorso", "RightUpperArm"}, {"RightUpperArm", "RightLowerArm"}, {"RightLowerArm", "RightHand"},
      {"LowerTorso", "LeftUpperLeg"},  {"LeftUpperLeg", "LeftLowerLeg"},  {"LeftLowerLeg", "LeftFoot"},
      {"LowerTorso", "RightUpperLeg"}, {"RightUpperLeg", "RightLowerLeg"}, {"RightLowerLeg", "RightFoot"}
   }

   for i = 1, #skeletonParts do
      skeletonLines[i] = Drawing.new("Line")
   end

   -- Box
   drawings.Box.Thickness    = 1.4
   drawings.Box.Filled       = false
   drawings.Box.Transparency = 1
   drawings.Box.Visible      = false

   -- Tracer
   drawings.Tracer.Thickness    = 1.3
   drawings.Tracer.Transparency = 0.65
   drawings.Tracer.Visible      = false

   -- Name & Distance
   drawings.Name.Size    = 14
   drawings.Name.Center  = true
   drawings.Name.Outline = true
   drawings.Name.Visible = false

   drawings.Distance.Size    = 12
   drawings.Distance.Center  = true
   drawings.Distance.Outline = true
   drawings.Distance.Visible = false

   -- Health
   drawings.HealthOut.Thickness    = 3
   drawings.HealthOut.Color        = Color3.new(0,0,0)
   drawings.HealthOut.Transparency = 1
   drawings.HealthOut.Visible      = false

   drawings.HealthIn.Thickness    = 1.8
   drawings.HealthIn.Transparency = 1
   drawings.HealthIn.Visible      = false

   -- Head dot
   drawings.HeadDot.Radius      = 4
   drawings.HeadDot.NumSides    = 16
   drawings.HeadDot.Filled      = true
   drawings.HeadDot.Transparency= 1
   drawings.HeadDot.Visible     = false

   -- Skeleton
   for _, line in ipairs(skeletonLines) do
      line.Thickness    = 1.6
      line.Transparency = 0.8
      line.Visible      = false
   end

   -- Highlight (Chams)
   local highlight = Instance.new("Highlight")
   highlight.Enabled           = false
   highlight.FillTransparency  = 0.45
   highlight.OutlineTransparency = 0
   highlight.DepthMode         = Enum.HighlightDepthMode.AlwaysOnTop

   ESP_Objects[player] = {
      Drawings = drawings,
      Skeleton = skeletonLines,
      Parts    = skeletonParts,
      Highlight= highlight
   }
end

local function RemoveESP(player)
   local data = ESP_Objects[player]
   if not data then return end

   for _, obj in pairs(data.Drawings) do
      pcall(function() obj:Remove() end)
   end

   for _, line in ipairs(data.Skeleton) do
      pcall(function() line:Remove() end)
   end

   if data.Highlight then
      data.Highlight:Destroy()
   end

   ESP_Objects[player] = nil
end

-- ────────────────────────────────────────────────
--  ESP UPDATE LOOP
-- ────────────────────────────────────────────────

local function UpdateESP()
   if not Settings.ESP_Enabled or not RootPart then return end

   local screenCenter = Camera.ViewportSize / 2
   local rainbow      = GetRainbow()

   for player, data in pairs(ESP_Objects) do
      local char   = player.Character
      if not char then
         for _, d in pairs(data.Drawings) do d.Visible = false end
         for _, l in ipairs(data.Skeleton) do l.Visible = false end
         data.Highlight.Enabled = false
         continue
      end

      local root = char:FindFirstChild("HumanoidRootPart")
      local hum  = char:FindFirstChild("Humanoid")
      local head = char:FindFirstChild("Head")

      if not (root and hum and head and hum.Health > 0) then
         for _, d in pairs(data.Drawings) do d.Visible = false end
         for _, l in ipairs(data.Skeleton) do l.Visible = false end
         data.Highlight.Enabled = false
         continue
      end

      local distance = (RootPart.Position - root.Position).Magnitude
      if distance > Settings.MaxDistance then
         for _, d in pairs(data.Drawings) do d.Visible = false end
         for _, l in ipairs(data.Skeleton) do l.Visible = false end
         data.Highlight.Enabled = false
         continue
      end

      local _, onScreen = Camera:WorldToViewportPoint(root.Position)
      if not onScreen then
         for _, d in pairs(data.Drawings) do d.Visible = false end
         for _, l in ipairs(data.Skeleton) do l.Visible = false end
         data.Highlight.Enabled = false
         continue
      end

      -- Visibility check
      local visible = true
      if Settings.VisibleCheck then
         local params = RaycastParams.new()
         params.FilterDescendantsInstances = {Character}
         params.FilterType = Enum.RaycastFilterType.Exclude
         local result = Workspace:Raycast(Camera.CFrame.Position, (root.Position - Camera.CFrame.Position), params)
         visible = result and result.Instance:IsDescendantOf(char) or false
      end

      local color = rainbow or GetESPColor(player, visible)

      -- Box sizing
      local top    = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.6, 0))
      local bottom = Camera:WorldToViewportPoint(root.Position - Vector3.new(0, 3.8, 0))
      local height = math.abs(top.Y - bottom.Y)
      local width  = height * 0.48

      local pos = Vector2.new(top.X - width/2, top.Y)

      -- Box / Corner logic simplified (using box for now - add corner later if wanted)
      data.Drawings.Box.Size      = Vector2.new(width, height)
      data.Drawings.Box.Position  = pos
      data.Drawings.Box.Color     = color
      data.Drawings.Box.Visible   = true   -- always show box when enabled (toggle corner later)

      -- Name
      data.Drawings.Name.Text     = player.Name
      data.Drawings.Name.Position = Vector2.new(pos.X + width/2, pos.Y - 18)
      data.Drawings.Name.Color    = color
      data.Drawings.Name.Visible  = true

      -- Distance
      data.Drawings.Distance.Text     = tostring(math.floor(distance)).." studs"
      data.Drawings.Distance.Position = Vector2.new(pos.X + width/2, pos.Y + height + 4)
      data.Drawings.Distance.Color    = color
      data.Drawings.Distance.Visible  = true

      -- Tracer
      data.Drawings.Tracer.From   = screenCenter
      data.Drawings.Tracer.To     = Vector2.new(pos.X + width/2, pos.Y + height)
      data.Drawings.Tracer.Color  = color
      data.Drawings.Tracer.Visible= Settings.Tracers

      -- Health bar
      if Settings.HealthBar then
         local hpPercent = hum.Health / hum.MaxHealth
         local barH      = height * hpPercent

         data.Drawings.HealthOut.From = Vector2.new(pos.X - 5, pos.Y)
         data.Drawings.HealthOut.To   = Vector2.new(pos.X - 5, pos.Y + height)
         data.Drawings.HealthOut.Visible = true

         data.Drawings.HealthIn.From  = Vector2.new(pos.X - 5, pos.Y + height - barH)
         data.Drawings.HealthIn.To    = Vector2.new(pos.X - 5, pos.Y + height)
         data.Drawings.HealthIn.Color = GetHealthColor(hum.Health, hum.MaxHealth)
         data.Drawings.HealthIn.Visible = true
      else
         data.Drawings.HealthOut.Visible = false
         data.Drawings.HealthIn.Visible  = false
      end

      -- Head dot
      local hdPos, _ = Camera:WorldToViewportPoint(head.Position)
      data.Drawings.HeadDot.Position = Vector2.new(hdPos.X, hdPos.Y)
      data.Drawings.HeadDot.Color    = color
      data.Drawings.HeadDot.Visible  = Settings.HeadDot

      -- Skeleton
      if Settings.Skeleton then
         for i, pair in ipairs(data.Parts) do
            local p1 = char:FindFirstChild(pair[1])
            local p2 = char:FindFirstChild(pair[2])
            if p1 and p2 then
               local pos1, v1 = Camera:WorldToViewportPoint(p1.Position)
               local pos2, v2 = Camera:WorldToViewportPoint(p2.Position)
               if v1 and v2 then
                  local ln = data.Skeleton[i]
                  ln.From   = Vector2.new(pos1.X, pos1.Y)
                  ln.To     = Vector2.new(pos2.X, pos2.Y)
                  ln.Color  = color
                  ln.Visible= true
               else
                  data.Skeleton[i].Visible = false
               end
            else
               data.Skeleton[i].Visible = false
            end
         end
      else
         for _, ln in ipairs(data.Skeleton) do ln.Visible = false end
      end

      -- Chams
      data.Highlight.Adornee    = char
      data.Highlight.FillColor  = color
      data.Highlight.OutlineColor = color:Lerp(Color3.new(1,1,1), 0.4)
      data.Highlight.Enabled    = Settings.Chams
   end
end

-- ────────────────────────────────────────────────
--  AIMBOT
-- ────────────────────────────────────────────────

local IsAiming = false

UserInput.InputBegan:Connect(function(input)
   if input.UserInputType == Enum.UserInputType.MouseButton2 then
      IsAiming = true
   end
end)

UserInput.InputEnded:Connect(function(input)
   if input.UserInputType == Enum.UserInputType.MouseButton2 then
      IsAiming = false
   end
end)

local function GetBestTarget()
   local center     = Camera.ViewportSize / 2
   local closest    = nil
   local bestDist   = Settings.FOV_Size

   for _, plr in ipairs(Players:GetPlayers()) do
      if plr == LocalPlayer then continue end
      if Settings.Aimbot_TeamCheck and plr.Team == LocalPlayer.Team then continue end

      local char = plr.Character
      if not char then continue end

      local hum = char:FindFirstChild("Humanoid")
      if not hum or hum.Health <= 0 then continue end

      local part = char:FindFirstChild(Settings.AimPart)
      if not part then continue end

      local predPos = part.Position + (part.AssemblyLinearVelocity * Settings.Prediction)
      local screen, visible = Camera:WorldToViewportPoint(predPos)

      if not visible then continue end

      local dist = (Vector2.new(screen.X, screen.Y) - center).Magnitude
      if dist < bestDist then
         bestDist = dist
         closest  = part
      end
   end

   return closest
end

local function RunAimbot()
   if not Settings.Aimbot or not IsAiming then return end

   local target = GetBestTarget()
   if not target then return end

   local predPos = target.Position + (target.AssemblyLinearVelocity * Settings.Prediction)
   local screenPos, onScreen = Camera:WorldToViewportPoint(predPos)

   if not onScreen then return end

   local center = Camera.ViewportSize / 2
   local delta  = Vector2.new(screenPos.X, screenPos.Y) - center
   local move   = delta * (1 - Settings.Smoothness)

   mousemoverel(move.X, move.Y)
end

-- ────────────────────────────────────────────────
--  MAIN LOOP
-- ────────────────────────────────────────────────

Connections.Render = RunService.RenderStepped:Connect(function()
   pcall(function()
      FOV.Position = Camera.ViewportSize / 2
      FOV.Radius   = Settings.FOV_Size
      FOV.Visible  = Settings.FOV_Circle and Settings.Aimbot

      if Settings.ESP_Enabled then
         UpdateESP()
      end

      RunAimbot()
   end)
end)

-- ────────────────────────────────────────────────
--  UI - RAYFIELD
-- ────────────────────────────────────────────────

local TabESP = Window:CreateTab("ESP", 4483362458)
local TabAim = Window:CreateTab("Aimbot", 4483345998)
local TabSet = Window:CreateTab("Settings", 4483345998)

-- ESP Tab
TabESP:CreateToggle({
   Name = "ESP Enabled",
   CurrentValue = false,
   Callback = function(v)
      Settings.ESP_Enabled = v
      if v then
         for _, p in ipairs(Players:GetPlayers()) do
            if p ~= LocalPlayer then CreateESP(p) end
         end
      else
         for p,_ in pairs(ESP_Objects) do RemoveESP(p) end
      end
   end
})

TabESP:CreateToggle({Name = "Tracers",     CurrentValue = false, Callback = function(v) Settings.Tracers = v     end})
TabESP:CreateToggle({Name = "Health Bar",  CurrentValue = false, Callback = function(v) Settings.HealthBar = v  end})
TabESP:CreateToggle({Name = "Head Dot",    CurrentValue = false, Callback = function(v) Settings.HeadDot = v    end})
TabESP:CreateToggle({Name = "Skeleton",    CurrentValue = false, Callback = function(v) Settings.Skeleton = v   end})
TabESP:CreateToggle({Name = "Chams",       CurrentValue = false, Callback = function(v) Settings.Chams = v      end})
TabESP:CreateToggle({Name = "Rainbow",     CurrentValue = false, Callback = function(v) Settings.Rainbow = v    end})
TabESP:CreateToggle({Name = "Team Check",  CurrentValue = true,  Callback = function(v) Settings.ESP_TeamCheck = v end})
TabESP:CreateSlider({
   Name = "Max Distance",
   Range = {500, 5000},
   Increment = 100,
   Suffix = "studs",
   CurrentValue = 3000,
   Callback = function(v) Settings.MaxDistance = v end
})

-- Aimbot Tab
TabAim:CreateToggle({
   Name = "Aimbot (Hold RMB)",
   CurrentValue = false,
   Callback = function(v) Settings.Aimbot = v end
})

TabAim:CreateToggle({
   Name = "Team Check (Aimbot)",
   CurrentValue = true,
   Callback = function(v) Settings.Aimbot_TeamCheck = v end
})

TabAim:CreateToggle({
   Name = "Show FOV Circle",
   CurrentValue = true,
   Callback = function(v) Settings.FOV_Circle = v end
})

TabAim:CreateSlider({
   Name = "FOV Size",
   Range = {80, 600},
   Increment = 5,
   Suffix = "",
   CurrentValue = 240,
   Callback = function(v) Settings.FOV_Size = v end
})

TabAim:CreateSlider({
   Name = "Smoothness",
   Range = {0.01, 0.4},
   Increment = 0.01,
   Suffix = "",
   CurrentValue = 0.11,
   Callback = function(v) Settings.Smoothness = v end
})

TabAim:CreateSlider({
   Name = "Prediction",
   Range = {0.05, 0.22},
   Increment = 0.001,
   Suffix = "",
   CurrentValue = 0.138,
   Callback = function(v) Settings.Prediction = v end
})

TabAim:CreateDropdown({
   Name = "Aim Part",
   Options = {"Head", "UpperTorso", "HumanoidRootPart"},
   CurrentOption = "Head",
   Callback = function(v) Settings.AimPart = v end
})

-- Settings Tab
TabSet:CreateButton({
   Name = "Unload / Cleanup",
   Callback = function()
      for _, conn in pairs(Connections) do
         pcall(function() conn:Disconnect() end)
      end
      FOV:Remove()
      for p,_ in pairs(ESP_Objects) do RemoveESP(p) end
      Rayfield:Notify({
         Title = "Unloaded",
         Content = "Script cleaned up.",
         Duration = 4
      })
   end
})

-- Player join/leave
Players.PlayerAdded:Connect(function(p)
   if Settings.ESP_Enabled and p ~= LocalPlayer then
      CreateESP(p)
   end
end)

Players.PlayerRemoving:Connect(RemoveESP)

-- Initial ESP
if Settings.ESP_Enabled then
   for _, p in ipairs(Players:GetPlayers()) do
      if p ~= LocalPlayer then CreateESP(p) end
   end
end

Rayfield:Notify({
   Title = "Arsenal Hub 2026 Loaded",
   Content = "Hold RMB to aim • Prediction active • Enjoy!",
   Duration = 6.5
})

print("Arsenal Hub 2026 • Rayfield UI • Visible Aimbot + ESP")
